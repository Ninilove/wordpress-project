#!/bin/bash
# build-and-deploy.sh

# Build the custom WordPress image
docker build -t ngouabounina/wordpress:6.3-php8.2-apache .

# Push to container registry
docker push ngouabounina/wordpress:6.3-php8.2-apache

# Deploy to Kubernetes
kubectl apply -f mysql-secret.yml
kubectl apply -f mysql-pvc.yml
kubectl apply -f mysql-deployment.yml
kubectl apply -f wordpress-pvc.yml
kubectl apply -f wordpress-deployment.yml
kubectl apply -f metrics-server.yml
kubectl apply -f wordpress-hpa.yml
kubectl apply -f mysql-hpa.yml
kubectl apply -f ingress-nginx-controller.yml
kubectl apply -f wordpress-ingress.yml

# Wait for deployment to complete
kubectl rollout status deployment/wordpress
